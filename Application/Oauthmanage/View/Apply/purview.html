<include file="Oauthmanage@Public:header" />
<!--列表展示-->
<div class="main-container" id="main-container">
	<script type="text/javascript">
		try{ace.settings.check('main-container' , 'fixed')}catch(e){}
	</script>
	<div class="main-container-inner">
		<a class="menu-toggler" id="menu-toggler" href="#">
			<span class="menu-text"></span>
		</a>
		<include file="Oauthmanage@Public:lside" />
		
		<div class="main-content">
			<div class="page-content">
				<div class="page-header">
					<h1>
						<i class="icon-desktop"></i>
						权限管理
					</h1>
				</div>
				<div class="row">
					<div class="col-xs-12">
						<!-- PAGE CONTENT BEGINS -->
						<div class="row" id="prinDiv">
							<div class="col-xs-12">
								<div class="table-responsive">
									<p>
										<button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">添加关联药店</button>
									</p>

									<div class="alert alert-info">
										CLIENT_ID：{$client.client_id}
										<br/>
										名称：{$client.title}
									</div>
									
									<empty name="info">
										<div class="alert alert-danger">
											<strong>暂无信息</strong>
										</div>
									<else />
										
										<table id="sample-table-1" border="1" class="table table-striped table-bordered table-hover">
											<thead>
												<tr>
													<th>ID</th>
													<th>药店名称</th>
													<th>添加时间</th>
													<th>状态</th>
												</tr>
											</thead>
											<tbody>
												<foreach name="info" key="key" item="vo" >
													<tr>
														<td>{$vo.id}</td>
														
														<td>
															{$vo.dname}
														</td>
														
														<td>
															{$vo.addtime}
														</td>

														<td>
															<if condition="($vo.status eq 2)">
															<a class="label label-danger lockdrugs lockdrugs{$vo.id}" href="javascript:;" data="{$vo.id}">禁用</a>
															<else />
															<a class="label label-success lockdrugs lockdrugs{$vo.id}" href="javascript:;" data="{$vo.id}">使用</a>
															</if>
														</td>
													</tr>
												</foreach>
											</tbody>
										</table>
									</empty>	 
								</div><!-- /.table-responsive -->

								

							</div><!-- /span -->
						</div><!-- /row -->
					</div><!-- /.col -->
				</div><!-- /.row -->
			</div><!-- /.page-content -->
		</div><!-- /.main-content -->
	</div><!-- /.main-container-inner -->

	<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
		<i class="icon-double-angle-up icon-only bigger-110"></i>
	</a>
</div>


<!--添加应用-->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  	<div class="modal-dialog">
  		<form class="form-horizontal" role="form">
    		<div class="modal-content">
      			<div class="modal-header">
        			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        			<h4 class="modal-title" id="myModalLabel">添加关联药店</h4>
      			</div>
      			<div class="modal-body">
      				<div class="row">
      					<div class="col-xs-12">
							<!-- PAGE CONTENT BEGINS -->
							<div class="form-group">
								<p id="err1"  style="background:#fdf8a8;border:1px solid #ded767; display:none; padding:5px 10px; margin:0 30px; color:red;" ></p>
							</div>

							<div class="space-4"></div>
							<div class="form-group">
								<label class="col-sm-3 control-label no-padding-right" for="form-field-1">药店ID:</label>
								<div class="col-sm-9">
									<input type="text" name="drugsid" id="drugsid" value="" placeholder="药店ID" class="col-xs-10 col-sm-5" />
								</div>
							</div>

							<div class="space-4"></div>
							<div class="form-group">
								<label class="col-sm-3 control-label no-padding-right" for="form-field-1">状态:</label>
								<div class="col-sm-9">
									<select name="islock" id="islock">
										<option value="0" checked>使用</option>
										<option value="1">禁用</option>
									</select>
								</div>
							</div>
      					</div>
      				</div>
      				<div class="modal-footer">
        				<button type="button" id="buttonNew" class="btn btn-primary">确定</button>
      				</div>
    			</div><!-- /.modal-content -->
  			</div><!-- /.modal-dialog -->
  		</form>
	</div><!-- /.modal -->	
</div>


<include file="Oauthmanage@Public:basicscripts" />

<script>
	$(function(){
		
		// 添加关联药店
		$("#buttonNew").click(function(){
			var drugsid		=	$("#drugsid").val();
	  		var islock		=	$("#islock").val();
	  		var clientid 	=	"{$clientid}";
	  		if( drugsid == '' ){
				$('#err1').text("药店ID不能为空").show();
				return false;
			}
			
	  		$.post(
	  			'/oauthmanage/apply/purviewadd',
	  			{drugsid:drugsid,islock:islock,clientid:clientid},
	  			function(rs){
				  	if(rs['status']==1){
		     			$('#myModal').modal('hide');
					  	window.location.reload();
		     	  	}else{
		     		 	$('#err1').text(rs.msg).show(); 
		     		 	return false;
		     	  	}
		 	}, 'json')
	  	})

	  	// 更新状态信息
		$(".lockdrugs").click(function(){
	  		var id 	=	$(this).attr('data');
	  		if( !id ){
				return false;
			}

			var clientid 	=	"{$clientid}";
	  		$.post(
	  			'/oauthmanage/apply/purviewedit',
	  			{clientid:clientid,id:id},
	  			function( rs ){
				  	if( rs.status == 1 ){
				  		$(".lockdrugs"+id).removeClass('label-danger').addClass('label-success');
				  		$(".lockdrugs"+id).html('使用');
		     	  	}else if( rs.status == 2 ){
		     	  		$(".lockdrugs"+id).removeClass('label-success').addClass('label-danger');
		     		 	$(".lockdrugs"+id).html('禁用');
		     	  	}
		 	}, 'json')
	  	})
	})

</script>

<include file="Oauthmanage@Public:footer" />