<include file="Oauthmanage@Public:header" />
<!--列表展示-->
<div class="main-container" id="main-container">
	<script type="text/javascript">
		try{ace.settings.check('main-container' , 'fixed')}catch(e){}
	</script>
	<div class="main-container-inner">
		<a class="menu-toggler" id="menu-toggler" href="#">
			<span class="menu-text"></span>
		</a>
		<include file="Oauthmanage@Public:lside" />
		
		<div class="main-content">
			<div class="page-content">
				<div class="page-header">
					<h1>
						<i class="icon-desktop"></i>
						应用管理
					</h1>
				</div>
				<div class="row">
					<div class="col-xs-12">
						<!-- PAGE CONTENT BEGINS -->
						<div class="row" id="prinDiv">
							<div class="col-xs-12">
								<div class="table-responsive">
									<p>
										<button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">添加应用</button>
									</p>
									<empty name="list">
										<div class="alert alert-danger">
											<strong>暂无信息</strong>
										</div>
									<else />
										<table id="sample-table-1" border="1" class="table table-striped table-bordered table-hover">
											<thead>
												<tr>
													<th>ID</th>
													<th>名称</th>
													<th>CLIENT_ID</th>
													<th>CLIENT_SECRET</th>
													<th>状态</th>
													<th>类型</th>
													<th>添加时间</th>
													<th>操作</th>
												</tr>
											</thead>
											<tbody>
												<foreach name="list" key="key" item="vo" >
													<tr>
														<td>{$vo.id}</td>
														<td>
															{$vo.title}
														</td>
														<td>
															{$vo.client_id}
														</td>
														<td>
															{$vo.client_secret}
														</td>
														<td>
															<if condition="($vo.islock eq 1)">  
															<span class="label label-danger">禁用</span>
															<else /> 
															<span class="label label-success">使用</span>
															</if>
														</td>
														<td>
															<if condition="($vo.status eq 1)">  
															K-BOX
															<elseif condition="($vo.status eq 3)" />  
															一号通
															<else /> 
															人体算法
															</if>
														</td>
														<td>
															{$vo.create_time|date='Y-m-d',###}
														</td>

														<td>
															<button type="button" onclick="showclient({$vo.id})" class="btn btn-xs btn-info">编辑</button>

															<if condition="($vo.status eq 3)">  

															<else />
																<a class="btn btn-xs btn-info" href="/oauthmanage/apply/purview/id/{$vo.id}">权限</a>
															</if>
														</td>
													</tr>
												</foreach>
											</tbody>
										</table>
									</empty>	 
								</div><!-- /.table-responsive -->

								<notempty name="pages">
									<div id="nomore" class="clearfix form-actions">
										<div id="more" class="col-md-offset-3 col-md-9">
											{$pages}
										</div>
									</div>
							  	</notempty>	

							</div><!-- /span -->
						</div><!-- /row -->
					</div><!-- /.col -->
				</div><!-- /.row -->
			</div><!-- /.page-content -->
		</div><!-- /.main-content -->
	</div><!-- /.main-container-inner -->

	<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
		<i class="icon-double-angle-up icon-only bigger-110"></i>
	</a>
</div>


<!--添加应用-->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  	<div class="modal-dialog">
  		<form class="form-horizontal" role="form">
    		<div class="modal-content">
      			<div class="modal-header">
        			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        			<h4 class="modal-title" id="myModalLabel">添加应用</h4>
      			</div>
      			<div class="modal-body">
      				<div class="row">
      					<div class="col-xs-12">
							<!-- PAGE CONTENT BEGINS -->
							<div class="form-group">
								<p id="err1"  style="background:#fdf8a8;border:1px solid #ded767; display:none; padding:5px 10px; margin:0 30px; color:red;" ></p>
							</div>

							<div class="space-4"></div>
							<div class="form-group">
								<label class="col-sm-3 control-label no-padding-right" for="form-field-1">名称:</label>
								<div class="col-sm-9">
									<input type="text" name="title" id="title" value="" placeholder="名称" class="col-xs-10 col-sm-5" />
								</div>
							</div>

							<div class="space-4"></div>
							<div class="form-group">
								<label class="col-sm-3 control-label no-padding-right" for="form-field-1">状态:</label>
								<div class="col-sm-9">
									<select name="islock" id="islock">
										<option value="0" checked>使用</option>
										<option value="1">禁用</option>
									</select>
								</div>
							</div>
							
							<div class="space-4"></div>
							<div class="form-group">
								<label class="col-sm-3 control-label no-padding-right" for="form-field-1">类型:</label>
								<div class="col-sm-9">
									<select name="status" id="status">
										<option value="1" checked>K-BOX</option>
										<option value="2">人体算法</option>
										<option value="3">一号通</option>
									</select>
								</div>
							</div>

							<div class="space-4"></div>
							<div class="form-group">
								<label class="col-sm-3 control-label no-padding-right" for="form-field-1">token有效期:</label>
								<div class="col-sm-9">
									<select name="types" id="types">
										<option value="1" checked>1天</option>
										<option value="2">7天</option>
										<option value="3">30天</option>
										<option value="4">90天</option>
										<option value="5">180天</option>
										<option value="6">365天</option>
									</select>
								</div>
							</div>

							
      					</div>
      				</div>
      				<div class="modal-footer">
        				<button type="button" id="buttonNew" class="btn btn-primary">确定</button>
      				</div>
    			</div><!-- /.modal-content -->
  			</div><!-- /.modal-dialog -->
  		</form>
	</div><!-- /.modal -->	
</div>


<!--编辑应用-->
<div class="modal fade" id="myModal3" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  	<div class="modal-dialog form-horizontal">
  		
    		<div class="modal-content">
      			<div class="modal-header">
        			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        			<h4 class="modal-title">编辑应用</h4>
      			</div>
      			<div class="modal-body">
      				<div class="row">
      					<div class="col-xs-12">
							<!-- PAGE CONTENT BEGINS -->
							<div class="form-group">
								<p id="err2"  style="background:#fdf8a8;border:1px solid #ded767; display:none; padding:5px 10px; margin:0 30px; color:red;" ></p>
							</div>

							<div class="space-4"></div>
							<div class="form-group">
								<label class="col-sm-3 control-label no-padding-right" for="form-field-1">名称:</label>
								<div class="col-sm-9">
									<input type="text" name="title2" id="title2" value="" placeholder="名称" class="col-xs-10 col-sm-5" />
								</div>
							</div>

							<div class="space-4"></div>
							<div class="form-group">
								<label class="col-sm-3 control-label no-padding-right" for="form-field-1">状态:</label>
								<div class="col-sm-9">
									<select name="islock2" id="islock2">
										<option value="0">使用</option>
										<option value="1">禁用</option>
									</select>
								</div>
							</div>
							
							<div class="space-4"></div>
							<div class="form-group">
								<label class="col-sm-3 control-label no-padding-right" for="form-field-1">token有效期:</label>
								<div class="col-sm-9">
									<select name="types2" id="types2">
										<option value="1">1天</option>
										<option value="2">7天</option>
										<option value="3">30天</option>
										<option value="4">90天</option>
										<option value="5">180天</option>
										<option value="6">365天</option>
									</select>
								</div>
							</div>

      					</div>
      				</div>
      				<div class="modal-footer">
       					<input type="hidden" name="clientid" id="clientid" />
        				<input type="submit" id="submit" value="确定" class="btn btn-primary" />
      				</div>
    			</div><!-- /.modal-content -->
  			</div><!-- /.modal-dialog -->
  		
	</div><!-- /.modal -->	
</div>

<include file="Oauthmanage@Public:basicscripts" />

<script>
	$(function(){
		
		// 添加应用
		$("#buttonNew").click(function(){
			var title		=	$("#title").val();
	  		var islock		=	$("#islock").val();
	  		var types		=	$("#types").val();
	  		var status		=	$('#status').val();
	  		if( title == '' ){
				$('#err1').text("名称不能为空").show();
				return false;
			}
			
	  		$.post(
	  			'/oauthmanage/apply/add',
	  			{title:title,islock:islock,types:types,status:status},
	  			function(rs){
				  	if(rs['status']==1){
		     			$('#myModal').modal('hide');
					  	window.location.reload();
		     	  	}else{
		     		 	$('#err1').text(rs.msg).show(); 
		     		 	return false;
		     	  	}
		 	}, 'json')
	  		
	  	})

	  	// 编辑应用基本信息
		$("#submit").click(function(){
	  		var id 			=	$('#clientid').val();
	  		var title		=	$("#title2").val();
	  		var islock		=	$("#islock2").val();
	  		var types		=	$("#types2").val();

	  		if( title == '' ){
				$('#err1').text("名称不能为空").show();
				return false;
			}

	  		$.post(
	  			'/oauthmanage/apply/edits',
	  			{clientid:id,title:title,islock:islock,types:types},
	  			function(rs){
				  	if( rs['status'] == 1 ){
		     			$('#myModal3').modal('hide');
					  	window.location.reload();
		     	  	}else{
		     		 	$('#err1').text(rs.msg).show(); 
		     		 	return false;
		     	  	}
		     	
		 	}, 'json')
	  	})
	})


	function showclient(id){
	 	if( id ){
	 		$.post('/oauthmanage/apply/getclient',{id:id},function(rs){
	 			if(rs){
	 				$("#title2").val(rs.title);
	 				
	 				$("#islock2").removeAttr("selected");
	 				
	 				$("#islock2").find("option[value='"+rs.islock+"']").attr("selected","selected");

	 				$("#types2").removeAttr("selected");
	 				$("#types2").find("option[value='"+rs.user_type+"']").attr("selected","selected");
	 				
		 			$("#clientid").val(rs.id);
		 			$('#myModal3').modal('show');	
	 			}
	 		},'json')
		}
	}
</script>

<include file="Oauthmanage@Public:footer" />